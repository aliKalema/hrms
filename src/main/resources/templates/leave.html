<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<html lang="en">
<head>
  <meta charset="utf-8" />
  <link rel="apple-touch-icon" sizes="76x76" th:href="@{/img/filename.jpg}" />
  <link rel="icon" type="image/png" th:href="@{/img/filename.jpg}" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>HRMS</title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
  <meta name="viewport" content="width=device-width" />
  <link rel="stylesheet" type="text/css" th:href="@{/webjars/font-awesome/5.15.0/css/all.css}">
  <script rel="stylesheet"  th:src="@{/webjars/font-awesome/5.15.0/js/all.js}"></script>
  <link rel="stylesheet" type="text/css" th:href="@{/webjars/material-design-icons/4.0.0/material-icons.css}">
  <link th:href="@{/webjars/bootstrap/3.3.5/css/bootstrap.min.css}" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap-material-design/0.5.10/css/bootstrap-material-design.css}">
  <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.css}">
  <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap-select/1.12.4/css/bootstrap-select.css}">
  <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap-clockpicker.css}">
  <link th:href="@{/css/material-dashboard.css}" rel="stylesheet"/>
  <link th:href="@{/css/payslip.css}" rel="stylesheet">
  <link th:href="@{/css/recommend.css}" rel="stylesheet">
</head>
<body>
<div class="wrapper" id="wrapper" style="display: none">

  <div class="sidebar" data-active-color="primary" data-background-color="black" data-image="/img/sidebar-3.jpg">
    <div class="logo">
      <a  class="simple-text logo-mini">

      </a>

      <a href="#" class="simple-text logo-normal">
        HRMS
      </a>
    </div>

    <div class="sidebar-wrapper">
      <div class="user">
        <div class="photo">
          <img th:src="@{${'/docs-upload/' +user.employee.image.name}}" />
        </div>
        <div class="info">
          <a data-toggle="collapse" href="#collapseExample" class="collapsed">
                    <span th:text="${user.username}">
                        <b class="caret"></b>
                    </span>
          </a>
          <div class="clearfix"></div>
          <div class="collapse" id="collapseExample">
            <ul class="nav">
              <li>
                <a data-toggle="modal" data-target="#lock-modal">
                  <span class="sidebar-mini"> CP </span>
                  <span class="sidebar-normal"> Change Password </span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <ul class="nav">
        <li>
          <a th:href="@{/admin/employee}">
            <i class="material-icons">people_alt</i>
            <p> Employees </p>
          </a>
        </li>
        <li >
          <a th:href="@{/admin/structure}" >
            <i class="material-icons">view_quilt</i>
            <p> Structure </p>
          </a>
        </li>
        <li class="active">
          <a th:href="@{/admin/leave}" >
            <i class="material-icons">weekend</i>
            <p>Leave </p>
          </a>
        </li>
        <li>
          <a data-toggle="collapse" href="#pagesAttendance">
            <i class="material-icons">history_toggle_off</i>
            <p> Attendance
              <b class="caret"></b>
            </p>
          </a>

          <div class="collapse" id="pagesAttendance">
            <ul class="nav">
              <li>
                <a th:href="@{/admin/attendance/log}">
                  <span class="sidebar-mini">AL</span>
                  <span class="sidebar-normal">Attandance Log</span>
                </a>
              </li>
              <li>
                <a th:href="@{/admin/attendance/schedule}">
                  <span class="sidebar-mini">SC</span>
                  <span class="sidebar-normal">Schedule</span>
                </a>
              </li>
            </ul>
          </div>
        </li>
        <li sec:authorize="hasRole('ROLE_HR')">
          <a data-toggle="collapse" href="#pagesExamples">
            <i class="material-icons sidebar-mini">account_balance_wallet</i>
            <p> Payment
              <b class="caret"></b>
            </p>
          </a>

          <div class="collapse" id="pagesExamples">
            <ul class="nav">
              <li>
                <a th:href="@{/hr/payroll}">
                  <span class="sidebar-mini"> PR </span>
                  <span class="sidebar-normal"> Payroll </span>
                </a>
              </li>
              <li>
                <a th:href="@{/hr/template}">
                  <span class="sidebar-mini"> PM </span>
                  <span class="sidebar-normal"> Pay Model </span>
                </a>
              </li>
            </ul>
          </div>
        </li>
        <li sec:authorize="hasRole('ROLE_HR')">
          <a th:href="@{/hr/general}">
            <i class="material-icons">tune</i>
            <p> General </p>
          </a>
        </li>
      </ul>
    </div>
  </div>


  <div class="main-panel">

    <nav class="navbar navbar-transparent navbar-absolute">
      <div class="container-fluid">
        <div class="navbar-minimize">
          <button id="minimizeSidebar" class="btn btn-round btn-white btn-fill btn-just-icon">
            <i class="material-icons visible-on-sidebar-regular">more_vert</i>
            <i class="material-icons visible-on-sidebar-mini">view_list</i>
          </button>
        </div>
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Leave </a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
              <a  class="dropdown-toggle" data-toggle="dropdown" data-color="success" >
                <i class="material-icons">notifications</i>
                <span class="notification" id="unreceived-size">0</span>
                <p class="hidden-lg hidden-md">
                  Notifications
                  <b class="caret"></b>
                </p>
              </a>
              <ul class="dropdown-menu panel-group"  id="unreceived-view"  role="tablist" aria-multiselectable="true">
                <li th:each="reminder:${unreceivedReminders}">
                  <a th:attr="onclick=${'viewUnReceived('+reminder.id+',this)'}">
                    &nbsp;<span th:text="${reminder.day +' '+ reminder.date+' '+reminder.time}"></span>
                  </a>
                </li>
              </ul>
            </li>
            <li>
              <a th:href="@{/logout}" class="dropdown-toggle"  data-color="success">
                <span class="material-icons">
                  logout
                  </span>
                <p class="hidden-lg hidden-md">Logout</p>
              </a>
            </li>
            <li class="separator hidden-lg hidden-md"></li>
          </ul>

        </div>
      </div>
    </nav>

    <div class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12">
            <div class="card card-stats" style="margin-bottom:10px">
              <div class="card-header" data-background-color="green">
                <i class="material-icons">pending_actions</i>
              </div>
              <div class="card-content panel panel-default" id="accordion" role="tablist" aria-multiselectable="true">
                <div style="display:flex;justify-content: space-between;">
                  <h4 id="onLeave-size" style="font-weight:500;margin-top:40px;"></h4>
                  <div  role="tab" style="margin-top:35px">
                    <a class="btn btn-white btn-fab btn-fab-mini btn-round" onclick="rotate(this)" data-expand="1" style="border:solid 1px #4caf50;" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne"><i class="material-icons text-lg "  style="color:#4caf50">expand_more</i><i class="material-icons text-lg " style="color:#4caf50;display:none">expand_less</i></a>
                  </div>
                </div>
                <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                  <div class="panel-body">
                    <div class="table-responsive">
                      <table class="table table-hover">
                        <thead>
                        <th>Image</th>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Job Title</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        </thead>
                        <tbody>
                        <tr th:each="leave:${onLeave}">
                          <td><img class="img-fluid rounded shadow" style="width: 50px;" th:src="@{${'/docs-upload/' +leave.employee.image.name}}"/></td>
                          <td th:text="${leave.employee.nationalId}"></td>
                          <td th:text="${leave.employee.name}"></td>
                          <td th:text="${leave.employee.jobTitle}"> </td>
                          <td th:text="${leave.startDate}"></td>
                          <td th:text="${leave.endDate}"></td>
                        </tr>

                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
          <div style="display:flex;align-items: stretch;padding-bottom:30px;">
              <div style="width:40%;align-items: stretch; box-sizing:border-box;margin-right: 15px;">
                  <div class="card" style="height:100%;">
              <div class="card-header" style="display: flex;row-gap: 10px;justify-content: space-between;box-sizing:border-box;">
                <label style="font-size: 22px;margin-top:18px">Leave Category</label>
                <button class="btn btn-primary" data-toggle="modal" data-target="#add-leave-category-modal" style="color:#fff">ADD</button>
              </div>
              <div class="card-content">
                <div class="table-responsive">
                  <table class="table">
                    <thead>
                    <tr>
                      <th>Name</th>
                      <th>Days</th>
                      <th>Rotate</th>
                      <th></th>
                    </tr>
                    </thead>
                    <tbody id = "category-table-body">
                    <tr th:each="category:${categories}" th:id="${category.id}">
                      <td th:text="${category.name}"></td>
                      <td th:text="${category.maxDays}"></td>
                      <td th:text="${category.rotate}"></td>
                      <td class="td-actions text-right">
                        <button th:attr="onclick=${'edit('+category.id+',this)'}"  type="button" rel="tooltip" class="btn btn-success btn-round">
                          <i class="material-icons">edit</i>
                        </button>
                        <button th:attr="onclick=${'deleteCategory('+category.id+',this)'}" type="button" rel="tooltip" class="btn btn-danger btn-round">
                          <i class="material-icons">delete</i>
                        </button>
                      </td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
              </div>
              <div  style="width:60%;align-items: stretch;box-sizing:border-box;">
                  <div class="card" style="height:100%;">
              <div class="card-header" style="display: flex;justify-content: space-between">
                <label style="font-size: 22px;margin-top:18px">Booked Leaves</label>
                <button class="btn btn-primary" data-toggle="modal" data-target="#add-leave-modal" style="color:#fff;">ADD</button>
              </div>
              <div class="card-content">
                <div class="table-responsive">
                  <table class="table">
                    <thead>
                    <tr>
                      <th>Name</th>
                      <th>Type</th>
                      <th>Start</th>
                      <th>End</th>
                    </tr>
                    </thead>
                    <tbody id="leave-table">
                    <tr th:each="leave:${leaves}">
                      <td th:text="${leave.employee.name}"style="text-align: center"></td>
                      <td th:text="${leave.categoryName}"style="text-align: center"></td>
                      <td th:text="${leave.startDate}"></td>
                      <td th:text="${leave.endDate}"></td>
                      <td class="td-actions text-right">
                        <button th:attr="onclick=${'edit('+leave.id+')'}" type="button" rel="tooltip" class="btn btn-success btn-round">
                          <i class="material-icons">edit</i>
                        </button>
                        <button th:attr="onclick=${'deleteCategory('+leave.id+',this)'}" type="button" rel="tooltip" class="btn btn-danger btn-round">
                          <i class="material-icons">delete</i>
                        </button>
                      </td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
              </div>
          </div>
      </div>
    </div>
  </div>
</div>

<div class="loader-wrapper">
  <div class="dot-container">
    <div class="dot dot1"></div>
    <div class="dot dot2"></div>
    <div class="dot dot3"></div>
  </div>
</div>

<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="gridSystemModalLabel" id="add-leave-category-modal">
  <div class="modal-dialog " role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title primary-text fw-4">Leave Category</h4>
      </div>
      <div class="modal-body" >
        <form id="leave-category-form">
          <div class="row">
            <div class="col-md-12">
              <div class="input-group">
                                           <span class="input-group-addon">
                                              <i class="material-icons">drive_file_rename_outline</i>
                                          </span>
                <div class="form-group label-floating">
                  <label class="control-label">NAME</label>
                  <input name="name"  id="name" type="text" class="form-control" required>
                </div>
              </div>
            </div>
            <div class="col-md-12">
            <div class="input-group">
                                           <span class="input-group-addon">
                                              <i class="material-icons">calendar_view_day</i>
                                          </span>
              <div class="form-group label-floating">
                <label class="control-label">MAXIMUM DAYS</label>
                <input name="maxDays"  id="maxDays" type="number" class="form-control" required>
              </div>
            </div>
          </div>
            <div class="col-md-12" style="margin-top: 10px;">
            <div class="checkbox checkbox-inline">
              <label>
                <input type="checkbox" id="annual_checkbox" name="optionsCheckboxes">ANNUAL
              </label>
            </div>
            <div class="checkbox checkbox-inline" style="margin-top:10px">
              <label>
                <input type="checkbox" id="monthly_checkbox" name="optionsCheckboxes">MONTHLY
              </label>
            </div>
            <div class="checkbox checkbox-inline" style="margin-top:10px">
              <label>
                <input type="checkbox" id="weekly_checkbox" name="optionsCheckboxes">WEEKLY
              </label>
            </div>
          </div>
            <div class="col-md-12">
            <button class="btn btn-primary" id="submit-category-btn" style="float:right;color:#fff">submit</button>
          </div>
          </div>
          <div class="modal-footer"></div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="gridSystemModalLabel" id="edit-leave-category-modal">
  <div class="modal-dialog " role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title primary-text fw-4">Leave Category</h4>
      </div>
      <div class="modal-body" >
        <div class="col-md-12">
          <div class="input-group">
                                         <span class="input-group-addon">
                                            <i class="material-icons">drive_file_rename_outline</i>
                                        </span>
            <div class="form-group label-floating">
              <label class="form-check-label">NAME</label>
              <input name="name"  id="e-name" type="text" class="form-control">
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="input-group">
                                         <span class="input-group-addon">
                                            <i class="material-icons">calendar_view_day</i>
                                        </span>
            <div class="form-group label-floating">
              <label class="form-check-label">MAXIMUM DAYS</label>
              <input name="maxDays"  id="e-maxDays" type="text" class="form-control">
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="checkbox checkbox-inline">
            <label>
              <input type="checkbox" id="e-annual_checkbox" name="optionsCheckboxes">ANNUALY
            </label>
          </div>
          <div class="checkbox checkbox-inline">
            <label>
              <input type="checkbox" id="e-monthly_checkbox" name="optionsCheckboxes">MONTHLY
            </label>
          </div>
          <div class="checkbox checkbox-inline">
            <label>
              <input type="checkbox" id="e-weekly_checkbox" name="optionsCheckboxes">WEEKLY
            </label>
          </div>
        </div>
        <div class="col-md-12">
          <button class="btn btn-primary" onclick="submitEdit()" style="float:right;color:#fff">submit</button>
        </div>
        <div class="modal-footer"></div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="gridSystemModalLabel" id="leave-modal">
  <div class="modal-dialog " role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title primary-text fw-4" id="gridSystemModalLabel">Add Leave</h4>
      </div>
      <div class="modal-body" >
        <form id="leave-form">
          <div class="row">
          <div class="col-md-6">
            <div class="form-group">
            <label class="bmd-label-floating">Name</label>
            <input type="text" class="form-control" id='employee-Name'  autocomplete ='off'>
            </div>
          </div>
          <div class="col-md-6">
              <select class="selectpicker" data-style="btn btn-white btn-round" title="Single Select" id="leave-category" name="leave-category" required>
                <option disabled selected>Leave Category</option>
              </select>
            </div>
          </div>
          <div class="row">
          <div class='col-md-6'>
            <div class="input-group date datepicker-group" data-provide="datepicker">
              <label class="bmd-label-floating">Start Date</label>
              <input type="text" class="form-control datetimepicker"  id="start-date" required>
              <div class="input-group-addon">
                <i class="far fa-calendar-alt"></i>
              </div>
            </div>
          </div>
          <div class='col-md-6'>
            <div class="input-group date datepicker-group" data-provide="datepicker" >
              <label class="bmd-label-floating">End Date</label>
              <input type="text" class="form-control datetimepicker"  id="end-date" required>
              <div class="input-group-addon">
                <i class="far fa-calendar-alt"></i>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <input type="submit"  value="submit" class="btn btn-primary" style="color:#ffff">
          </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="gridSystemModalLabel" id="add-leave-modal">
  <div class="modal-dialog " role="document">
    <div class="modal-content">
      <div class="modal-body">
        <div class="search-input">
          <a href="" target="_blank" hidden></a>
          <input id="emp-search-input" type="text" placeholder="Enter Employee Name">
          <div class="autocom-box" id="search-emp-list">
            <!-- here list are inserted from javascript -->
          </div>
          <div class="icon" style="margin-top:42px;margin-right:10px"><i class="fas fa-search"></i></div>
        </div>
        </div>
      </div>
    </div>
    <div class="modal-footer"></div>
  </div>

<div class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="gridSystemModalLabel" id="lock-modal">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-body" >
        <div style="display:flex;justify-content: center;margin-top:-70px">
          <a href="#pablo">
            <img class="avatar" style="height:100px;width: 80px" th:src="@{${'/docs-upload/' +user.employee.image.name}}" alt="...">
          </a>
        </div>
        <form id="lock-form">
          <div class="row">
            <div class="col-md-12" style="display: flex;justify-content:center;">
              <h4 class="card-title" th:text="${user.username}"></h4>
            </div>
            <div class="col-md-12">
              <div class="form-group label-floating">
                <label class="control-label">Current Password</label>
                <input type="text" id="current-password" class="form-control secure" autocomplete="off" required>
              </div>
              <div class="form-group label-floating">
                <label class="control-label">New Password <small> (minimum 4 characters)</small></label>
                <input type="text" id="new-password" class="form-control secure" autocomplete="off" required>
              </div>
              <div class="form-group label-floating">
                <label class="control-label">Confirm New Password</label>
                <input type="text" id="confirm-password" class="form-control secure" autocomplete="off" required>
              </div>
            </div>
            <div class="col-md-12" style="display: flex;justify-content: center">
              <button  id="submit-password" class="btn btn-primary btn-round" style="color:#ffffff">Submit</button>
            </div>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>
</body>

<!--   Core JS Files   -->
<script th:src="@{/webjars/jquery/3.3.1/jquery.js}"></script>
<script th:src="@{/webjars/bootstrap-material-design/0.5.10/js/material.js}"></script>
<script th:src="@{/webjars/bootstrap/3.3.5/js/bootstrap.js}"></script>
<script th:src="@{/js/perfect-scrollbar.jquery.min.js}" type="text/javascript"></script>

<!-- Library for adding dinamically elements -->
<script th:src="@{/js/arrive.min.js}" type="text/javascript"></script>

<!-- Forms Validations Plugin -->
<script th:src="@{/js/jquery.validate.min.js}"></script>

<!--  Plugin for Date Time Picker and Full Calendar Plugin-->
<script th:src="@{/js/moment.min.js}"></script>

<!--  Charts Plugin, full documentation here: https://gionkunz.github.io/chartist-js/ -->
<script th:src="@{/js/chartist.min.js}"></script>

<!--  Plugin for the Wizard, full documentation here: https://github.com/VinceG/twitter-bootstrap-wizard -->
<script th:src="@{/js/jquery.bootstrap-wizard.js}"></script>

<!--  Notifications Plugin, full documentation here: https://bootstrap-notify.remabledesigns.com/    -->
<script th:src="@{/js/bootstrap-notify.js}"></script>

<!--   Sharrre Library    -->
<script th:src="@{/js/jquery.sharrre.js}"></script>

<!-- Vector Map plugin, full documentation here: https://jvectormap.com/documentation/ -->
<script th:src="@{/js/jquery-jvectormap.js}"></script>

<!-- Sliders Plugin, full documentation here: https://refreshless.com/nouislider/ -->
<script th:src="@{/js/nouislider.min.js}"></script>

<!--  Plugin for Select, full documentation here: https://silviomoreto.github.io/bootstrap-select -->
<script th:src="@{/webjars/bootstrap-select/1.12.4/js/bootstrap-select.js}"></script>

<!--  DataTables.net Plugin, full documentation here: https://datatables.net/    -->
<script th:src="@{/js/jquery.datatables.js}"></script>

<!-- Sweet Alert 2 plugin, full documentation here: https://limonte.github.io/sweetalert2/ -->
<script th:src="@{/js/sweetalert2.js}"></script>

<!-- Plugin for Fileupload, full documentation here: https://www.jasny.net/bootstrap/javascript/#fileinput -->
<script th:src="@{/js/jasny-bootstrap.min.js}"></script>

<!--  Full Calendar Plugin, full documentation here: https://github.com/fullcalendar/fullcalendar    -->
<script th:src="@{/js/fullcalendar.min.js}"></script>

<!-- Plugin for Tags, full documentation here: https://github.com/bootstrap-tagsinput/bootstrap-tagsinputs  -->
<script th:src="@{/js/jquery.tagsinput.js}"></script>

<script th:src="@{/webjars/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.js}"></script>

<!-- Material Dashboard javascript methods -->
<script th:src="@{/js/material-dashboard.js}"></script>
<script th:src="@{/webjars/sockjs-client/1.1.2/sockjs.min.js}"></script>
<script th:src="@{/webjars/stomp-websocket/2.3.3-1/stomp.min.js}"></script>
<script th:inline="javascript">
  var categories = [[${categories}]];
  var leaves = [[${leaves}]];
  var onLeave = [[${onLeave}]]
  var unreceivedReminders = [[${unreceivedReminders}]];
</script>
<script>
  $(document).ready(function() {
    connect();
    var stompClient = null;
    document.getElementById('unreceived-size').innerHTML =  unreceivedReminders.length.toString();
  });
  let employees;
  let employeeId;
  let cateoryHolder;
  let categoryElement;
  document.getElementById('onLeave-size').innerHTML = `On Leave: ${onLeave.length}`;
  document.getElementById('leave-form').addEventListener('submit',submitLeave);
  getOptions(categories,'leave-category');
  const searchWrapper = document.querySelector(".search-input");
  const inputBox = searchWrapper.querySelector("input");
  const suggBox = searchWrapper.querySelector(".autocom-box");
  const icon = searchWrapper.querySelector(".icon");
  let linkTag = searchWrapper.querySelector("a");
  let webLink;
  inputBox.onkeyup = (e)=>{
    suggBox.innerHTML = '';
    let userData = e.target.value; //user enetered data
    let emptyArray = [];
    if(userData){
      fetch("/api/admin/employees/search/sort/"+userData)
              .then(res=>res.json())
              .then(function(employees){
                return employees;
              })
              .then(function(employees){
                emptyArray = employees;
                searchWrapper.classList.add("active");
                if(emptyArray.length>0){
                  for(let employee of emptyArray){
                    let li =  document.createElement('li');
                    li.className="row";
                    li.id=`${employee.id}`;
                    li.innerHTML = `<div class="col-md-2"><img class="avatar" alt="Image placeholder" src="/docs-upload/${employee.image.name}"></div>
                                    <div class="col-md-7"><h4>${employee.name}</h4></div>
                                    <div class="col-md-3"><h4>${employee.nationalId}</h4></div>`;
                    suggBox.appendChild(li);
                  }
                }
                let allList = suggBox.querySelectorAll("li");
                for (let i = 0; i < allList.length; i++) {
                  allList[i].setAttribute("onclick", "select(this)");
                }
              })
    }else{
      searchWrapper.classList.remove("active"); //hide autocomplete box
    }
  }
  $('#add-leave-modal').on('hidden.bs.modal', function(event) {
    document.getElementById('emp-search-input').value="";
    document.getElementById('search-emp-list').innerHTML="";
  });
  $('#leave-modal').on('hidden.bs.modal', function(event) {
    document.getElementById('leave-form').reset();
  });

  function submitLeave(e){
    e.preventDefault();
    const startDate = document.getElementById('start-date').value;
    const endDate = document.getElementById('end-date').value;
    const categoryName = document.getElementById('leave-category').value;
    if(categoryName.toLowerCase()==="leave category"){
      alert("Select Leave Type");
    }
    else {
      const formData = new FormData();
      formData.append("startDate", startDate);
      formData.append("endDate", endDate);
      formData.append("categoryName", categoryName);
      let resOk=true;
      fetch('/api/admin/leave/' + employeeId, {
        method: 'POST',
        body: formData
      }).then(function (res) {
        if (!res.ok) {
          resOk = false;
        }
        return res.json();
      }).then(function(leave){
        $('#leave-modal').modal('hide');
        if(!resOk){
          errorNotify(leave.responseText);
          throw new Error(leave.statusText);
        }
        else{
          successNotify("Leave Added");
          const tr = document.createElement('tr');
          tr.innerHTML = `<td style="text-align: center">${leave.employee.name}</td>
                  <td style="text-align: center">${leave.categoryName}</td>
                  <td>${leave.startDate}</td>
                  <td>${leave.endDate}</td>
                  <td class="td-actions text-right">
                    <button onclick="edit(${leave.id})" type="button" rel="tooltip" class="btn btn-success btn-round">
                      <i class="material-icons">edit</i>
                    </button>
                    <button onclick="deleteCategory(${leave.id})" type="button" rel="tooltip" class="btn btn-danger btn-round">
                      <i class="material-icons">delete</i>
                    </button>
                  </td>`;
          document.getElementById('leave-table').appendChild(tr);
        }
      })
    }
  }

  function rotate(element){
    if (element.dataset.expand == "1"){
      element.children[0].style.display = "none";
      element.children[1].style.display = "block";
      element.dataset.expand = "0";
    }
    else if (element.dataset.expand == "0"){
      element.children[0].style.display = "block";
      element.children[1].style.display = "none";
      element.dataset.expand = "1";
    }
  }

  function select(element){
    let selectData = element.textContent;
    inputBox.value = selectData;
    let name= selectData.split(" ")[0]
    for(let i = 1;i<selectData.split(" ").length-1;i++){
      name = element.children[1].children[0].innerHTML;
      employeeId =  element.id;
      document.getElementById('employee-Name').value = name;
      document.getElementById('employee-Name').disabled = true;
      $("#add-leave-modal").modal('hide');
      $('#leave-modal').modal('show');
    }
    searchWrapper.classList.remove("active");
  }

  function getOptions(options,selectId){
    const select = document.getElementById(selectId);
    for(let opt of options){
      let option = document.createElement("option");
      option.value = opt.name;
      option.text = opt.name;
      select.add(option,select.opt);
    }
    $('.selectpicker').selectpicker('refresh');
  }

  function showSuggestions(list){
    let listData;
    if(!list.length){
      userValue = inputBox.value;
      listData = `<li>${userValue}</li>`;
    }else{
      listData = list.join('');
    }
    suggBox.innerHTML = listData;
  }

  document.getElementById('annual_checkbox').addEventListener('click',function(){
    checkboxClick(document.getElementById('annual_checkbox'),document.getElementById('weekly_checkbox'),document.getElementById('monthly_checkbox'));
  });
  document.getElementById('monthly_checkbox').addEventListener('click',function(){
    checkboxClick(document.getElementById('monthly_checkbox'),document.getElementById('weekly_checkbox'),document.getElementById('annual_checkbox'));
  });
  document.getElementById('weekly_checkbox').addEventListener('click',function(){
    checkboxClick(document.getElementById('weekly_checkbox'),document.getElementById('monthly_checkbox'),document.getElementById('annual_checkbox'));
  });
  document.getElementById('e-annual_checkbox').addEventListener('click',function(){
    checkboxClick(document.getElementById('e-annual_checkbox'),document.getElementById('e-weekly_checkbox'),document.getElementById('e-monthly_checkbox'));
  });
  document.getElementById('e-monthly_checkbox').addEventListener('click',function(){
    checkboxClick(document.getElementById('e-monthly_checkbox'),document.getElementById('e-weekly_checkbox'),document.getElementById('e-annual_checkbox'));
  });
  document.getElementById('e-weekly_checkbox').addEventListener('click',function(){
    checkboxClick(document.getElementById('e-weekly_checkbox'),document.getElementById('e-monthly_checkbox'),document.getElementById('e-annual_checkbox'));
  });
  document.getElementById('submit-category-btn').addEventListener('click',submitLeaveCategory);

  function deleteCategory(id,element){
    swal({
      title: 'Remove LeaveCategory  ',
      text: "You won't be able to revert this!",
      type: 'warning',
      showCancelButton: true,
      confirmButtonClass: 'btn btn-success',
      cancelButtonClass: 'btn btn-danger',
      confirmButtonText: 'Yes, clear it!',
      buttonsStyling: false
    })
            .then(function(){
              fetch("/api/admin/leave/category/delete/"+id)
                      .then(function(res){
                        if(!res.ok){
                          throw Error('Something Went Wrong')
                        }
                        else{
                          const row =  element.parentNode.parentNode;
                          row.remove();
                          employeeTable.draw();
                          swal({
                            title: 'Removed!',
                            text: 'Leave Category Removed',
                            type: 'success',
                            timer: 1500,
                            confirmButtonClass: "btn btn-success",
                            buttonsStyling: false
                          })
                        }
                      })
            }).catch(swal.noop)
  }

  function edit(id,element){
    categoryHolder = id;
    categoryElement = element.parentNode.parentNode;
    document.getElementById('e-name').value = document.getElementById(id).children[0].innerHTML;
    document.getElementById('e-maxDays').value =document.getElementById(id).children[1].innerHTML;
    if(document.getElementById(id).children[2].innerText ==='annually'){
      document.getElementById('e-annual_checkbox').checked = true;
    }
    else if(document.getElementById(id).children[2].innerText ==='monthly'){
      document.getElementById('e-monthly_checkbox').checked = true;
    }
    else if(document.getElementById(id).children[2].innerText ==='weekly'){
      document.getElementById('e-weekly_checkbox').checked = true;
    }
    $('#edit-leave-category-modal').modal('show');
  }

  function submitEdit(){
    const name = document.getElementById('e-name').value;
    const maxDays = document.getElementById('e-maxDays').value;
    let rotate;
    $('#edit-leave-category-modal').modal('hide')
    if(document.getElementById('e-annual_checkbox').checked){
      rotate =  "annually";
    }
    if(document.getElementById('e-monthly_checkbox').checked){
      rotate = "monthly";
    }
    if(document.getElementById('e-weekly_checkbox').checked){
      rotate =  "weekly";
    }
    fetch("/api/admin/leave/category/edit/"+categoryHolder,{
      method:'POST',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({name:name,maxDays:maxDays, rotate:rotate})
    })
            .then(function(res){
              if(res.status === 208){
                errorNotify("Name Already Exist...");
                throw new Error(res.statusText);
              }
              return res;
            })
            .then(function(res){
              if(!res.ok){
                errorNotify("Something Went Wrong");
                throw new Error(res.statusText);
              }
              return res.json();
            })
            .then(function(category){
              const row =categoryElement.parentNode.parentNode;
              row.innerHTML =`<td>${category.name}</td>
                                    <td>${category.maxDays}</td>
                                    <td>${category.rotate}</td>
                                    <td class="td-actions text-right">
                                        <button onclick="edit(${category.id},this)" type="button" rel="tooltip" class="btn btn-success btn-round">
                                            <i class="material-icons">edit</i>
                                        </button>
                                        <button onclick=deleteCategory(${category.id},this) type="button" rel="tooltip" class="btn btn-danger btn-round">
                                            <i class="material-icons">delete</i>
                                        </button>
                                    </td>`;
              successNotify("Leave Category Added Successfully");
              $('edit-leave-category-modal').modal('hide');
            })
  }

  function checkboxClick(a,b,c){
    a.checked =  true;
    b.checked = false;
    c.checked= false;
  }

  function submitLeaveCategory(){
    const name = document.getElementById('name').value;
    const maxDays = document.getElementById('maxDays').value;
    let rotate;
    if(document.getElementById('annual_checkbox').checked){
      rotate =  "annually";
    }
    if(document.getElementById('monthly_checkbox').checked){
      rotate = "monthly";
    }
    if(document.getElementById('weekly_checkbox').checked){
      rotate =  "weekly";
    }
    fetch("/api/admin/leave/category",{
      method:'POST',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({name:name,maxDays:maxDays, rotate:rotate})
    })
            .then(function(res){
              if(res.status === 208){
                errorNotify("Name Already Exist...");
                throw new Error(res.statusText);
              }
              return res;
            })
            .then(function(res){
              if(!res.ok){
                errorNotify("Something Went Wrong");
                throw new Error(res.statusText);
              }
              return res.json();
            })
            .then(function(category){
              const table =  document.getElementById('category-table-body');
              const tableRow = document.createElement('tr');
              tableRow.innerHTML =      `<td>${category.name}</td>
                                    <td>${category.maxDays}</td>
                                    <td>${category.rotate}</td>
                                    <td class="td-actions text-right">
                                        <button onclick="edit(${category.id},this)" type="button" rel="tooltip" class="btn btn-success btn-round">
                                            <i class="material-icons">edit</i>
                                        </button>
                                        <button onclick=deleteCategory(${category.id},this) type="button" rel="tooltip" class="btn btn-danger btn-round">
                                            <i class="material-icons">delete</i>
                                        </button>
                                    </td>`;
              table.appendChild(tableRow);
              const option = document.createElement('option');
              option.value = category.name;
              option.text = category.name;
              const select = document.getElementById('leave-category');
              select.add(option, select.options.length);
              $('.selectpicker').selectpicker('refresh');
              successNotify("Leave Category Added Successfully");
              $('#add-leave-category-modal').modal('hide');
            })
    document.getElementById('weekly_checkbox').checked =false;
    document.getElementById('annual_checkbox').checked = false;
    document.getElementById('annual_checkbox').checked= false;
    document.getElementById('maxDays').value = "";
    document.getElementById('name').value="";
  }
</script>
<script th:src="@{/js/collection.js}"></script>
</html>

