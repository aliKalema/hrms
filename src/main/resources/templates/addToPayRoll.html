<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<html lang="en">
<head>
  <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" th:href="@{/img/filename.jpg}" />
    <link rel="icon" type="image/png" th:href="@{/img/filename.jpg}" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>HRMS</title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
  <meta name="viewport" content="width=device-width" />
  <link rel="stylesheet" type="text/css" th:href="@{/webjars/font-awesome/5.15.0/css/all.css}">
  <script rel="stylesheet"  th:src="@{/webjars/font-awesome/5.15.0/js/all.js}"></script>
  <link rel="stylesheet" type="text/css" th:href="@{/webjars/material-design-icons/2.2.0/iconfont/material-icons.css}">
  <link th:href="@{/webjars/bootstrap/3.3.5/css/bootstrap.min.css}" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap-material-design/0.5.10/css/bootstrap-material-design.css}">
  <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.css}">
  <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap-select/1.12.4/css/bootstrap-select.css}">
  <link th:href="@{/css/material-dashboard.css}" rel="stylesheet"/>
  <link th:href="@{/css/fontawesome.min.css}" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link th:href="@{/css/payslip.css}" rel="stylesheet">
  </head>
<body >
<div class="wrapper">

  <div class="sidebar" data-active-color="primary" data-background-color="black" data-image="/img/sidebar-1.jpg">
   <div class="logo">
      <a  class="simple-text logo-mini">
        
      </a>

      <a href="#" class="simple-text logo-normal">
        HRMS
      </a>
    </div>

    <div class="sidebar-wrapper">
      <div class="user">
        <div class="photo">
          <img th:src="@{/img/faces/avatar.jpg}" />
        </div>
        <div class="info">
          <a data-toggle="collapse" href="#collapseExample" class="collapsed">
                    <span>
                         Tania Andrew 
                    </span>
          </a>
          <div class="clearfix"></div>
        </div>
      </div>
      <ul class="nav">
        <li >
          <a th:href="@{/admin/dashboard}">
            <i class="material-icons">dashboard</i>
            <p> Dashboard </p>
          </a>
        </li>
        <li >
          <a th:href="@{/admin/employee}">
            <i class="material-icons">people_alt</i>
            <p> Employees </p>
          </a>
        </li>
        <li >
          <a th:href="@{/attendance}">
            <i class="material-icons">history_toggle_off</i>
            <p> Attendance </p>
          </a>
        </li>
        <li>
          <a data-toggle="collapse" href="#pagesExamples">
            <i class="material-icons">image</i>
            <p> PayManagement
              <b class="caret"></b>
            </p>
          </a>

          <div class="collapse" id="pagesExamples">
            <ul class="nav">
              <li class="active">
                <a th:href="@{/hr/payroll}">
                  <span class="sidebar-mini"> PR </span>
                  <span class="sidebar-normal"> PayRoll </span>
                </a>
              </li>
              <li>
                <a href="@{/hr/payhead">
                  <span class="sidebar-mini"> PH </span>
                  <span class="sidebar-normal"> PayHead </span>
                </a>
              </li>
            </ul>
          </div>
        </li>
        <li >
          <a th:href="@{/admin/payroll}" >
            <i class="material-icons">view_quilt</i>
            <p> Structure </p>
          </a>
        </li>
        
      </ul>
    </div>
  </div>


  <div class="main-panel">

    <nav class="navbar navbar-transparent navbar-absolute">
      <div class="container-fluid">
        <div class="navbar-minimize">
          <button id="minimizeSidebar" class="btn btn-round btn-white btn-fill btn-just-icon">
            <i class="material-icons visible-on-sidebar-regular">more_vert</i>
            <i class="material-icons visible-on-sidebar-mini">view_list</i>
          </button>
        </div>
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#"> Pay Templates </a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            
            <li >
              <a  class="dropdown-toggle simple" >
                <i class="material-icons">receipt_long</i>ADD Template
                <p class="hidden-lg hidden-md">
                  Template
                  <b class="caret"></b>
                </p>
              </a>
            </li>
            
            <li class="dropdown">
              <a  class="dropdown-toggle simple" data-toggle="dropdown" data-color="success" id="dropdown-not-btn">
                <i class="material-icons">calculate</i>Tax
                <p class="hidden-lg hidden-md">
                  Tax
                  <b class="caret"></b>
                </p>
              </a>
              <div class="dropdown-menu" id="notification-list" aria-labelledby="dropdown-not-btn" >
              	<div class="tax-wrapper">
              		<div class="tax-wrapper-header">
              		 <div><h4>Tax Rates</h4></div>
              		 <div>
              		 	<button class="btn btn-success" style="color:#fff" data-toggle="modal" data-target="#add-tax-modal">
						  <i class="material-icons">edit</i> Edit
						</button>
					 </div>
              		</div>
              		<hr>
              		<div class="tax-wrapper-body" id="tax-wrapper-body">
              		</div>
              	</div>
              </div>
            </li>
            
            <li>
              <a th:href="@{/logout}" class="dropdown-toggle"  data-color="success">
                <span class="material-icons">
                  logout
                  </span>
                <p class="hidden-lg hidden-md">Logout</p>
              </a>
            </li>
            <li class="separator hidden-lg hidden-md"></li>
          </ul>
        </div>
      </div>
    </nav>



    <div class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              
              <div class="card-content">
                <div class="toolbar payslip-btn-group">
                 <div>
                 <button class="btn btn-default btn-round" style="color:#ffffff" id="add-earning-deduction" data-toggle="modal" data-target="#add-payhead-modal"> 
                 Add PayHead</button>
                 </div>
                 <div>
                 <button class="btn btn-success btn-fab btn-fab-mini btn-round"><i class="material-icons">edit</i></button>
                 <button class="btn btn-danger btn-fab btn-fab-mini btn-round"><i class="material-icons">delete</i></button>
                 </div>
                </div>
                <div class="payslip-container">
                <div class="payslip-header-container">
                	<div class="element-header">
                	<h4>Earnings</h4>
                	</div>
                	<div class="element-header">
                	<h4>Tax Calculations</h4>
                	</div>
                	<div class="element-header">
                	<h4>Deductions</h4>
                	</div>
                	<div class="element-header">
                	<h4>Net Pay</h4>
                	</div>
                </div>
                <div class="element-body-container">
                	<div class="element-body">
                		<ul class="units-list">
                			<li class="unit">
                				<div class="unit-label">Basic Salary</div>
                				<label class="unit-value">28880.00</label>
                			</li>
                			<li class="unit">
                				<div class="unit-label">House Allowance</div>
                				<label class="unit-value">7650.00</label>
                			</li>
                			<li class="unit">
                				<div class="unit-label">Act Allowance</div>
                				<label class="unit-value">150000</label>
                			</li>
                			<li class="unit">
                				<div class="unit-label">Travel Allowance</div>
                				<label class="unit-value">2000.00</label>
                			</li>
                			<li class="unit">
                				<div class="unit-label">leave Pay</div>
                				<label class="unit-value">9690.00</label>
                			</li>
                		</ul>
                	</div>
                	<div class="element-body">
                	</div>
                	<div class="element-body">
                	</div>
                	<div class="element-body">
                	</div>
                </div>
                </div>
                
              </div><!-- end content-->
            </div><!--  end card  -->
          </div> <!-- end col-md-12 -->
        </div> <!-- end row -->

      </div>
    </div>
  </div>
</div>

  <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="gridSystemModalLabel" id="add-tax-modal">
  <div class="modal-dialog " role="document">
  <div class="modal-content">
      <div class="modal-header">
            <h4 class="modal-title primary-text fw-4" id="gridSystemModalLabel">Edit Rates</h4>
      </div>
      <div class="modal-body">
      	<div class="rate-container">
      		<div class="rate-headers">
      		    <div style="width:20%"></div>
      			<div class="rate-bands">
      			<label>Tax Bands/month</label>
      			</div>
      			<div class="rate-rate">
      			<label>Rate</label>
      			</div>
      			<div style="width:5%"></div>
      		</div>
      		<ul class="rate-list" id="rate-list">
      		<li class="rate-item">
      		 	<div class="item-first">less than</div>
      		 	<div class="item-second">
      		 	<input type="number"  style="width:80%">
      		 	</div>
      		 	<div class="item-third">
      		 	<label>exempted</label>
      		 	</div>
      		 	<div class="item-fourth"></div>
      		 </li>
      		 <li class="rate-item">
      		 	<div class="item-first">next</div>
      		 	<div class="item-second">
      		 	<input type="number" style="width:80%">
      		 	</div>
      		 	<div class="item-third">
      		 	<input type="number"  style="width:100px; height:25px"><span>%</span>
      		 	</div>
      		 	<div class="item-fourth">
      		 	<button id="add-nxt-rate" class="btn btn-primary btn-fab btn-fab-mini btn-round" style="float:right">
				  <i class="material-icons">arrow_downward</i>
				</button>
      		 	</div>
      		 </li>
      		 <li class="rate-item" id="over-rate">
      		 	<div class="item-first">over</div>
      		 	<div class="item-second">
      		 	<input type="number"  style="width:80%">
      		 	</div>
      		 	<div class="item-third">
      		 	<input type="number"  style="width:100px"><span>%</span>
      		 	</div>
      		 	<div class="item-fourth"></div>
      		 </li>
      		</ul>
      		<h4>Reliefs</h4>
      		<div class="relief-headers">
      		   <div style="width:20%"></div>
      			<div class="rate-bands"><label>Relief Name</label></div>
      			<div class="rate-rate"><label>Rate</label></div>
      			
      		</div>
      		<ul class="relief-list" id="relief-list">
      			<li>
      				<div class="item-first"></div>
      				<div class="item-second">
      				<input type="text">
      				</div>
      				<div class="item-third">
      				<input type="number" style="width:100px;height:25px;"><span>%</span>
      				</div>
      				<div class="item-fourth">
	      		 	<button id="add-nxt-relief" class="btn btn-primary btn-fab btn-fab-mini btn-round">
					  <i class="material-icons">arrow_downward</i>
					</button>
	      		 	</div>
	      		</li>
      		</ul>
      		<div class="rate-btn-wrapper">
      			<div class="float-right"><button class="btn btn-primary"style="color:#fff" id="rate-submit">submit</button></div>
      		</div>
      	</div>
      </div>
  </div>
  </div>
  </div>
  
  <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="gridSystemModalLabel" id="add-payhead-modal">
  <div class="modal-dialog " role="document">
  <div class="modal-content">
      <div class="modal-header">
            <h4 class="modal-title primary-text fw-4" id="gridSystemModalLabel">Add Payhead</h4>
      </div>
      <div class="modal-body">
      	<form id="payhead-form">
      	
      	<div class="form-group">
           <label class="bmd-label-floating">Name</label>
           <input type="text" class="form-control"  name='name' autocomplete ='off' >
        </div>
        <div class="form-group">
           <label class="bmd-label-floating">Amount</label>
           <input type="number" class="form-control" name='amount' autocomplete ='off' >
        </div>
        <select class="selectpicker" data-style="btn btn-white btn-round" title="Single Select" id="payhead-type" name="payhead-type" required>
           <option disabled selected>Select Type</option>
           <option value="deduction">Deduction</option>
           <option value="earning">Earning</option>
        </select>
      	</form>
      </div>
  </div>
  </div>
  </div>

</body>

<!--   Core JS Files   -->
<script th:src="@{/webjars/jquery/3.3.1/jquery.js}"></script>
<script th:src="@{/webjars/bootstrap-material-design/0.5.10/js/material.js}"></script>
<script th:src="@{/webjars/bootstrap/3.3.5/js/bootstrap.js}"></script>
<script th:src="@{/js/perfect-scrollbar.jquery.min.js}" type="text/javascript"></script>

<!-- Library for adding dinamically elements -->
<script th:src="@{/js/arrive.min.js}" type="text/javascript"></script>

<!-- Forms Validations Plugin -->
<script th:src="@{/js/jquery.validate.min.js}"></script>

<!--  Plugin for Date Time Picker and Full Calendar Plugin-->
<script th:src="@{/webjars/momentjs/2.24.0/moment.js}"></script>

<!--  Plugin for the Wizard, full documentation here: https://github.com/VinceG/twitter-bootstrap-wizard -->
<script th:src="@{/js/jquery.bootstrap-wizard.js}"></script>

<!--  Notifications Plugin, full documentation here: https://bootstrap-notify.remabledesigns.com/    -->
<script th:src="@{/webjars/bootstrap-notify/3.1.3-1/bootstrap-notify.js}"></script>

<!--   Sharrre Library    -->
<script th:src="@{/js/jquery.sharrre.js}"></script>

<!-- Vector Map plugin, full documentation here: https://jvectormap.com/documentation/ -->
<script th:src="@{/js/jquery-jvectormap.js}"></script>

<!-- Sliders Plugin, full documentation here: https://refreshless.com/nouislider/ -->
<script th:src="@{/js/nouislider.min.js}"></script>

<!--  Plugin for Select, full documentation here: https://silviomoreto.github.io/bootstrap-select -->
<script th:src="@{/webjars/bootstrap-select/1.12.4/js/bootstrap-select.js}"></script>

<!--  DataTables.net Plugin, full documentation here: https://datatables.net/    -->
<script th:src="@{/webjars/datatables/1.10.12/js/jquery.dataTables.js}"></script>

<!-- Sweet Alert 2 plugin, full documentation here: https://limonte.github.io/sweetalert2/ -->
<script th:src="@{/js/sweetalert2.js}"></script>

<!-- Plugin for Fileupload, full documentation here: https://www.jasny.net/bootstrap/javascript/#fileinput -->
<script th:src="@{/js/jasny-bootstrap.min.js}"></script>

<!--  Full Calendar Plugin, full documentation here: https://github.com/fullcalendar/fullcalendar    -->
<script th:src="@{/js/fullcalendar.min.js}"></script>

<!-- Plugin for Tags, full documentation here: https://github.com/bootstrap-tagsinput/bootstrap-tagsinputs  -->
<script th:src="@{/js/jquery.tagsinput.js}"></script>

<script th:src="@{/webjars/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.js}"></script>

<!-- Material Dashboard javascript methods -->
<script th:src="@{/js/material-dashboard.js}"></script>
<script th:src="@{/js/timepicki.js}"></script>
<script src="/webjars/sockjs-client/1.1.2/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/2.3.3-1/stomp.min.js"></script>
<script>
    // Facebook Pixel Code Don't Delete
    !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
        n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
        document,'script','//connect.facebook.net/en_US/fbevents.js');

    try{
        fbq('init', '111649226022273');
        fbq('track', "PageView");

    }catch(err) {
        console.log('Facebook Track Error:', err);
    }
</script>
<script>
getTax();
let tax={
		less:null,
		overBand:null,
		overRate:null,
		next:[],
		relief:[]
}
document.getElementById('add-nxt-rate').addEventListener('click',addRateItem);
document.getElementById('add-nxt-relief').addEventListener('click',addReliefItem);
document.getElementById('rate-submit').addEventListener('click',submitRate);
  function addRateItem(){
	  const rateList = document.getElementById('rate-list');
	  document.getElementById('over-rate').remove();
	  document.getElementById('add-nxt-rate').remove();
	  const output =`<li class="rate-item">
	 	<div class="item-first">next</div>
	 	<div class="item-second">
	 	<input type="number" style="width:80%">
	 	</div>
	 	<div class="item-third">
	 	<input type="number"  style="width:100px; height:25px"><span>%</span>
	 	</div>
	 	<div class="item-fourth">
	 	<button id="add-nxt-rate" class="btn btn-primary btn-fab btn-fab-mini btn-round" style="float:right">
		  <i class="material-icons">arrow_downward</i>
		</button>
	 	</div>
	 </li>
	 <li class="rate-item" id="over-rate">
	 	<div class="item-first">over</div>
	 	<div class="item-second">
	 	<input type="number"  style="width:80%">
	 	</div>
	 	<div class="item-third">
	 	<input type="number"  style="width:100px"><span>%</span>
	 	</div>
	 	<div class="item-fourth"></div>
	 </li>`;
	 rateList.innerHTML = rateList.innerHTML +output;
	 document.getElementById('add-nxt-rate').addEventListener('click',addRateItem);
  }
  
  function addReliefItem(){
	  const reliefList = document.getElementById('relief-list');
	  document.getElementById('add-nxt-relief').remove();
	  const output = `<li>
			<div class="item-first"></div>
			<div class="item-second">
			<input type="text">
			</div>
			<div class="item-third">
			<input type="number" style="width:100px;height:25px;"><span>%</span>
			</div>
			<div class="item-fourth">
		 	<button id="add-nxt-relief" class="btn btn-primary btn-fab btn-fab-mini btn-round">
			  <i class="material-icons">arrow_downward</i>
			</button>
		 	</div>
		</li>`;
		reliefList.innerHTML = reliefList.innerHTML + output;
		document.getElementById('add-nxt-relief').addEventListener('click',addReliefItem);
		
  }
  
  function getTax(){
	  fetch("/api/admin/tax")
	  	.then(res =>res.json())
	  	.then(function(tax){
	  		const nextRanges =[];
	  		let output =`<ul>
				  		<li class="tax-item">
				  		<div class="tax-label"></div>
				  		<div class="tax-band">${tax.less}</div>
				  		<div class="tax-value">exempted</div>
				  		</li>`;
				  		
	  		for(let i=2;i<tax.next.length+2;i++){
	  			if(tax.next[i-2].position == i){
	  				text=`<li class="tax-item">
				  		<div class="tax-label">next</div>
				  		<div class="tax-band">${tax.next[i-2].band}</div>
				  		<div class="tax-value unit-value">${tax.next[i-2].rate}%</div>
				  		</li>`
				  		output = output +text;
	  			}
	  		}
	  		output = output + `<li class="tax-item">
	  		<div class="tax-label">over</div>
	  		<div class="tax-band">${tax.overBand}</div>
	  		<div class="tax-value unit-value">${tax.overRate}%</div>
	  		</li></ul>`;
	  		document.getElementById('tax-wrapper-body').innerHTML = output;
	  	})
  }
  
  function submitRate(e){
	  e.preventDefault();
	  const rateList = document.getElementById('rate-list').children;
	  const reliefList = document.getElementById('relief-list').children;
	  for(let i = 0;i<rateList.length;i++){
		  if(i == 0){
			  let band = rateList[i].children[1].children[0].value;
			  tax.less=band;
		  }
		  else if(i == rateList.length-1){
			  let band = rateList[i].children[1].children[0].value;
			  let rate = rateList[i].children[2].children[0].value;
			  tax.overBand=band;
			  tax.overRate=rate;
		  }
		  else{
		  let band = rateList[i].children[1].children[0].value;
		  let rate = rateList[i].children[2].children[0].value;
		   tax.next.push({band:band,rate:rate,position:i+1});
		  }
	  }
	  for(let i =0;i<reliefList.length;i++){
		  let name = reliefList[i].children[1].children[0].value;
		  let rate = reliefList[i].children[2].children[0].value;
		  tax.relief.push({name:name,rate:rate})
	  }
	  const taxJson = JSON.stringify(tax);
	  fetch('/api/hr/tax',{
		  method:'POST',
		  headers: {
		      'Accept': 'application/json',
		      'Content-Type': 'application/json'
		    },
		  body:taxJson
		  })
		  .then(function(res){
			  if(!res.status== 200){
				  errorNotify('Something went Wrong');  
				  $('#add-payhead-modal').modal('hide');
				  throw Error(res.statusText);
			  }
			  return res;
		   })
		   .then(function(res){
			   $('#add-payhead-modal').modal('hide');
			   successNotify("Tax Edited Successfullty");
			   })
	  }
  
  function successNotify(message){
	  $.notify({},{
	      type: 'maximalise',
	      timer: 5000,
	      placement: {
	          from: 'top',
	          align: 'right'
	      },
	      template: '<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert">' +
	      			'<div class="row">'+
		      			'<div class="col-md-3">'+
		      			  '<span data-notify="icon" class="fas fa-check-circle"></span>'+
		      			'</div>'+
		      			'<div class="col-md-6">'+
		      			'<label style="color:#ffffff ">'+ message +'</label>'+
						'</div>'+
		      			'<div class="col-md-3">'+
		      			  '<button type="button" aria-hidden="true" class="close" data-notify="dismiss">×</button>'+
						'</div>'+
					'</div>'+
					'</div>'
	  }); 
  }
  
  function errorNotify(message){
	  $.notify({},{
	      type: 'errormalise',
	      timer: 5000,
	      placement: {
	          from: 'top',
	          align: 'right'
	      },
	      template: '<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert">' +
	      			'<div class="row">'+
		      			'<div class="col-md-2">'+
		      			  '<span data-notify="icon" class="fas fa-check-circle"></span>'+
		      			'</div>'+
		      			'<div class="col-md-8">'+
		      			'<label style="color:#ffffff ">'+ message +'</label>'+
						'</div>'+
		      			'<div class="col-md-2">'+
		      			  '<button type="button" aria-hidden="true" class="close" data-notify="dismiss">×</button>'+
						'</div>'+
					'</div>'+
					'</div>'
	  }); 
  }              
</script>
</html>